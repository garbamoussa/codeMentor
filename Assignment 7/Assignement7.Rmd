---
title: "Assignment7"
author: "GARBA Moussa"
date: "4/26/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Resources
In this problem set, we will use the New Haven data set. You can load it with:

```{r}

suppressPackageStartupMessages(library(GISTools))
data(newhaven)

```


```{r}
glimpse(burgres.n@coords)
```






The SpatialPoints layer “burgres.n” contains a point pattern of non-forced-entry burglary incidents in New Haven. You can compute the mean nearest neighbor distance for this point pattern using the nndist function in the spatstat package:


```{r}
suppressPackageStartupMessages(library(spatstat))
mean(nndist(as.ppp(burgres.n)))

```


#Questions

1.	Consider the null hypothesis that the points in the burgres.n point pattern were generated by a completely random spatial process. Use a Monte Carlo simulation to calculate the probability of observing a mean nearest neighbor distance less than or equal to 1269.034 feet under complete spatial randomness. Do you have evidence to reject the null hypothesis of complete spatial randomness? Be sure that you appropriately account for the study region in your Monte Carlo simulation (i.e., the border of New Haven). (7 points)

```{r}
class(burgres.n)
```



```{r}
plot(blocks)
plot(burgres.n, add=T, col="blue", pch=16)

```

```{r}
class(burgres.n)
burgres.ppp <- as.ppp(burgres.n)
class(burgres.ppp)
plot(envelope(burgres.ppp, fun=Fest, nrank=2, nsim=99))
```



```{r}
numpoints <- length(burgres.n)
randpoints <- spsample(blocks, numpoints, type="random")
plot(blocks)
plot(burgres.n, add=T, col="red", pch=16)
plot(randpoints, add=T, col="blue", pch=16)
```




```{r}
burgres.env.wrong <- envelope(burgres.ppp, fun=Fest, nrank=2, nsim=99, r= seq(0,3000,10))
```

```{r}
burgres.env.right <-envelope(burgres.ppp, fun=Fest,nrank=2, nsim=99, r= seq(0,3000,10), simulate=expression(as.ppp(spsample(blocks, length(burgres.n), type="random"))))
```

```{r}
plot(blocks)
plot(burgres.ppp, add=T, col="red", pch=16)
plot(as.ppp(randpoints), add=T, col="blue", pch=16)
```



```{r}
par(mfrow=c(1,2))
plot(burgres.env.wrong, ylim=c(0,1))
plot(burgres.env.right, ylim=c(0,1))
```
```{r}


```



```{r}
n_sizes<-seq(from=5, by=15, length.out=1000)

draw_exp <- function(size){
  nnd <- nndist(as.ppp(burgres.n))
  mu <- mean(nnd)
}
nnd <- nndist(as.ppp(burgres.n))
means <- mean(nnd)

hist(means,breaks=1000)
```


```{r}
lambda=5
nsize<-c(5, 10, 300, 1500)

for(i in nsize){
  n_sizes <- rep(i,5000)
  means <- mean(nnd)
  hist(means,main=paste0("Sample size = ",i),breaks=1000,border="blue")
  abline(v=1/lambda,col="red",lwd=5)
}
```

```{r}
F. <- function(means,lambda){
  return(1-exp(-lambda*means))
}

F.plot.vals <- F.(means,lambda=2)

par(mfrow=c(3,3))

curve(F.(lambda=1,x),from=1,to=30)
curve(F.(lambda=2,x),from=1,to=30)
curve(F.(lambda=5,x),from=1,to=30)
curve(F.(lambda=10,x),from=1,to=30)
curve(F.(lambda=20,x),from=1,to=30)
curve(F.(lambda=0.9,x),from=1,to=30)
curve(F.(lambda=0.5,x),from=1,to=30)
curve(F.(lambda=0.2,x),from=1,to=30)
curve(F.(lambda=0.1,x),from=1,to=30)
```

```{r}
means <- mean(nnd)
F.inv <- function(means,lambda){
  return(-1/lambda*log10(1-means))
}

X <- F.inv(means,lambda=5)

f. <- function(x,lambda){
  return(lambda*exp(-lambda*x))
}

Y <- f.(X,5)

x <- seq(0,1,length.out = 10000)

densiity.x <- dexp(x=x,rate=5)
par(mfrow=c(1,1))
plot(x=x,y=densiity.x,type="l",lwd=5)
points(x=X,y=Y,col="red",cex=0.1)
```


```{r}
#define target distribution f(x)
f. <- function(x){
  return(exp((-x^2)/2)*sin(2*x)^2)
}

#define candidate distribution h(x)

h. <- function(x){
  
  return((1/sqrt(2*pi))*exp((-x^2)/2))
  
}

#define f(x)/h(x):

f.x_h.x <- function(x){
  return(sqrt(2*pi*(sin(2*x))^2))
}

C <- max(f.x_h.x(x=-means:means))

plot(x=-means:means,y=f.x_h.x(-means:means),type="l")
abline(h=C,col="red",lwd=5)
abline(h=sqrt(2*pi),col="yellow",lwd=2)
```


```{r}
F_shared_aljunied = Fest(burgres.ppp, correction = "all")
plot(F_shared_aljunied)
```

To confirm the observed spatial patterns above, a hypothesis test will be conducted. The hypothesis and test are as follows:

Ho = The distribution ofburgres.ppp are randomly distributed.

H1= The distribution of burgres.ppp are not randomly distributed.

The null hypothesis will be rejected is p-value is smaller than alpha value of 0.001.


```{r}

L_shared_aljunied.csr <- envelope(burgres.ppp, Lest, nsim = 999, rank = 2, glocal=TRUE)

```



```{r}
plot(L_shared_aljunied.csr, . - r ~ r, xlab="d", ylab="L(d)-r")
```
Conclusion: Since the it is below the envelopes, therefore it is clustered pattern
